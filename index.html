<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Indian Finder</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: #0b1222;
      color: #e5e7eb;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 24px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 { margin: 0; font-weight: 900; letter-spacing: .05em; }
    .header-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .badge {
      background: rgba(255,255,255,.08);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: .85rem;
      font-weight: 700;
    }
    .xconnect-btn {
      text-decoration: none;
      color: #e5e7eb;
      border: 1px solid rgba(255,255,255,.18);
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 700;
      background: rgba(255,255,255,.06);
    }

    .layout {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .hero {
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 10px;
    }
    .hero-sub {
      color: #9ca3af;
      margin-bottom: 18px;
      line-height: 1.5;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(90deg,#ff7a18,#ff4ecd);
      border: none;
      padding: 14px 22px;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: 900;
      cursor: pointer;
      color: #0b1222;
      margin-bottom: 12px;
    }

    .secondary-btn {
      display: inline-block;
      margin-right: 10px;
      margin-top: 6px;
      text-decoration: none;
      color: #e5e7eb;
      border: 1px solid rgba(255,255,255,.18);
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      font-weight: 700;
    }

    footer {
      margin-top: 14px;
      color: #9ca3af;
      font-size: .85rem;
    }

    .player-card {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 20px;
      padding: 14px;
    }

    .media-shell {
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer;
    }

    video, img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .placeholder {
      color: #9ca3af;
      text-align: center;
      font-weight: 700;
    }

    .video-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    .upvote-btn {
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: #e5e7eb;
      padding: 8px 14px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 800;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: #111827;
      border: 1px solid rgba(255,255,255,.18);
      padding: 10px 16px;
      border-radius: 999px;
      opacity: 0;
      transition: opacity .2s;
    }
    .toast.show { opacity: 1; }
  </style>
</head>

<body>

<header>
  <h1>INDIAN FINDER</h1>
  <div class="header-right">
    <div class="badge">üáÆüá≥ üé¨ üòÇ <span>Videos + Memes, one button</span></div>
    <a class="xconnect-btn" href="#" id="xConnectBtn">Connect to X</a>
  </div>
</header>

<div class="layout">

  <!-- LEFT -->
  <div>
    <div class="hero">Press the button.<br/>Watch someone else fail.</div>
    <div class="hero-sub">
      Each click shows a random <strong>video fail</strong> or
      <strong>image meme</strong> from the vault. We support MP4, JPG & PNG.
    </div>

    <button class="btn" id="showFailBtn">üé¨ Show me a fail üí•</button><br/>

    <a class="secondary-btn" href="leaderboard.html">üèÜ Leaderboard</a>
    <a class="secondary-btn" href="submit.html">‚¨ÜÔ∏è Upload your fail</a>

    <footer>
      Upload fails to help power the vault. New uploads drop straight into the rotation.
    </footer>
  </div>

  <!-- RIGHT -->
  <div class="player-card">
    <div class="media-shell" id="mediaShell">
      <div class="placeholder">Tap ‚ÄúShow me a fail‚Äù</div>
    </div>

    <div class="video-meta">
      <div id="videoTitle">No fail loaded yet</div>
      <button class="upvote-btn" id="upvoteBtn" disabled>‚¨ÜÔ∏è Upvote ¬∑ 0</button>
    </div>
  </div>

</div>

<div class="toast" id="toast">New fail loaded</div>

<script>
const API_BASE = "https://inidan-finder-production-c13b.up.railway.app";

let MEDIA_ITEMS = [];
let currentItem = null;

const showBtn = document.getElementById("showFailBtn");
const mediaShell = document.getElementById("mediaShell");
const upvoteBtn = document.getElementById("upvoteBtn");
const videoTitle = document.getElementById("videoTitle");
const toast = document.getElementById("toast");

function showToast(text) {
  toast.textContent = text;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 1600);
}

async function loadFails() {
  const r = await fetch(`${API_BASE}/api/fails`, { cache: "no-store" });
  MEDIA_ITEMS = await r.json();
}

function renderItem(item) {
  mediaShell.innerHTML = "";
  const url = item.url.startsWith("http") ? item.url : API_BASE + item.url;

  let el;
  if (item.mediaType === "image") {
    el = document.createElement("img");
    el.src = url;
  } else {
    el = document.createElement("video");
    el.src = url;
    el.controls = true;
    el.autoplay = true;
    el.loop = true;
  }

  mediaShell.appendChild(el);
  videoTitle.textContent = item.title || "Fail";
  upvoteBtn.disabled = false;
  upvoteBtn.textContent = `‚¨ÜÔ∏è Upvote ¬∑ ${item.votes || 0}`;

  mediaShell.onclick = () => {
    window.location.href = `fail.html?id=${encodeURIComponent(item.id)}`;
  };
}

showBtn.onclick = async () => {
  if (!MEDIA_ITEMS.length) await loadFails();
  if (!MEDIA_ITEMS.length) return alert("No fails yet!");

  const item = MEDIA_ITEMS[Math.floor(Math.random() * MEDIA_ITEMS.length)];
  currentItem = item;
  renderItem(item);
  showToast("New fail loaded");
};

upvoteBtn.onclick = async () => {
  if (!currentItem) return;

  currentItem.votes = (currentItem.votes || 0) + 1;
  upvoteBtn.textContent = `‚¨ÜÔ∏è Upvote ¬∑ ${currentItem.votes}`;

  await fetch(`${API_BASE}/api/fails/${currentItem.id}/upvote`, { method: "POST" });
};
</script>

</body>
</html>



